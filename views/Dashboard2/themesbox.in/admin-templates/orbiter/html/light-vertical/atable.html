<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div class="contentbar">
        <!-- Form Section -->
        <div class="row">
          <div class="col-lg-12">
            <div class="card m-b-30">
              <div class="card-header">
                <h5 class="card-title" id="formTitle">Add New Property</h5>
              </div>
              <div class="card-body">
                <form id="propertyForm">
                  <input type="hidden" id="propertyId" name="id">
      
                  <div class="input-group mb-3">
                    <div class="custom-file">
                      <input type="file" class="custom-file-input" id="images" name="images" multiple>
                      <label class="custom-file-label" for="images">Choose images (1-10)</label>
                    </div>
                  </div>
      
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" id="location" name="location" placeholder="Enter location" required>
                  </div>
      
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" id="price" name="price" placeholder="Enter price" required>
                  </div>
      
                  <div class="input-group mb-3">
                    <input type="text" class="form-control" id="size" name="size" placeholder="Enter size (e.g., 5 acres)">
                  </div>
      
                  <div class="input-group mb-3">
                    <select class="custom-select" id="availability" name="availability" required>
                      <option value="" selected>Select availability</option>
                      <option value="Available">Available</option>
                      <option value="Not Available">Not Available</option>
                    </select>
                  </div>
      
                  <div class="input-group mb-3">
                    <select class="custom-select" id="category" name="category" required>
                      <option value="" selected>Select property category</option>
                      <option value="For Sale">For Sale</option>
                      <option value="For Rent">For Rent</option>
                    </select>
                  </div>
      
                  <div class="input-group mb-3">
                    <textarea class="form-control" id="description" name="description" placeholder="Enter property description" rows="3" required></textarea>
                  </div>
      
                  <div class="input-group mb-3">
                    <button type="submit" class="btn btn-primary" id="submitButton"><i class="feather icon-send mr-2"></i>Submit</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      
        <!-- Table Section -->
        <div class="row">
          <div class="col-lg-12">
            <div class="card m-b-30">
              <div class="card-header">
                <h5 class="card-title">Property Listings</h5>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-striped table-bordered" id="propertyTable">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>Images</th>
                        <th>Location</th>
                        <th>Price</th>
                        <th>Size</th>
                        <th>Availability</th>
                        <th>Category</th>
                        <th>Description</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <script>
        const fetchProperties = () => {
          // Replace with your API endpoint
          fetch('http://localhost:3000/api/lands')
            .then(response => response.json())
            .then(properties => {
              const tableBody = document.querySelector('#propertyTable tbody');
              tableBody.innerHTML = '';
              properties.forEach((property, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                  <td>${index + 1}</td>
                  <td>${property.images.map(img => `<img src="${img}" alt="Property Image" style="width: 50px;">`).join(' ')}</td>
                  <td>${property.location}</td>
                  <td>${property.price}</td>
                  <td>${property.size || '-'}</td>
                  <td>${property.availability}</td>
                  <td>${property.category}</td>
                  <td>${property.description}</td>
                  <td>
                    <button class="btn btn-sm btn-warning" onclick="editProperty('${property._id}')">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteProperty('${property._id}')">Delete</button>
                  </td>
                `;
                tableBody.appendChild(row);
              });
            });
        };
      
        document.getElementById('propertyForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const id = document.getElementById('propertyId').value;
          const images = Array.from(document.getElementById('images').files);
      
          if (images.length < 1 || images.length > 10) {
            alert('Please upload between 1 and 10 images.');
            return;
          }
      
          const formData = new FormData();
          images.forEach((file, index) => formData.append(`images[${index}]`, file));
          formData.append('location', document.getElementById('location').value);
          formData.append('price', document.getElementById('price').value);
          formData.append('size', document.getElementById('size').value || '');
          formData.append('availability', document.getElementById('availability').value);
          formData.append('category', document.getElementById('category').value);
          formData.append('description', document.getElementById('description').value);
      
          const method = id ? 'PUT' : 'POST';
          const url = id ? `http://localhost:3000/api/lands/${id}` : 'http://localhost:3000/api/lands';
      
          fetch(url, { method, body: formData })
            .then(() => {
              fetchProperties();
              document.getElementById('propertyForm').reset();
              document.getElementById('formTitle').innerText = 'Add New Property';
            });
        });
      
        const deleteProperty = (id) => {
          fetch(`http://localhost:3000/api/lands/${id}`, { method: 'DELETE' })
            .then(() => fetchProperties());
        };
      
        const editProperty = (id) => {
          fetch(`http://localhost:3000/api/lands/${id}`)
            .then(res => res.json())
            .then(property => {
              document.getElementById('propertyId').value = property._id;
              document.getElementById('location').value = property.location;
              document.getElementById('price').value = property.price;
              document.getElementById('size').value = property.size || '';
              document.getElementById('availability').value = property.availability;
              document.getElementById('category').value = property.category;
              document.getElementById('description').value = property.description;
              document.getElementById('formTitle').innerText = 'Edit Property';
            });
        };
      
        fetchProperties();
      </script>
      
</body>
</html>